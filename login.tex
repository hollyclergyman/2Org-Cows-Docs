% !TEX root = Documentation.tex

\section{The webbased User Interface}
The user interface for the database has been developed as a graphical interface to allow broad acces to the database. In the following, the different pages and their corresponding 
scripts, in the web frontend, are described in detail.


\subsection{login.php}
The login.php site serves as the welcome site of the whole project, including basic information on the function of the sites for user access to the database.\\
For security reasons and to track the visitors of the page, basic information about the visitor is stored in a separate database. This includes IP addresses, user agent of 
the browser and the time of access. To comply with the lawful requirement not to store personal information, such as full IP addresses, the IP address is shortened to three blocks,
which does not allow single user identification for non-logged-in users.\\
The page also starts a short test session, to check, whether cookies are are allowed in the browser. The result is not completely true, as it technically requires a reload of the 
page, which is not forced by the script.
The login works with HTML5 forms, organized in a table to allow easier configuration to various screen sizes and offer the entering of username and password. 
These forms consists of a text input with the input widget for text, to enter the username and a password input with the 
password widget. To prevent CSRF-attacks on the visitors of the page, a random sequence is generated by the server and linked to the page. This sequence is requested in the 
processing of the login during login\_script.php to check for CSRF-attacks and to issue an alert if the sequences do not match. 
Furthermore there is a submit button, which is submits the form data. Submitting this form starts processing of the form data with login\_script.php .

\subsection{login\_script.php}
The login\_script.php script processes the data submitted from the login form. For security reasons, 
authentication makes use of two different databases. The authentication database does not include any other data than the data required to initiate a session. In contrast,
the agri\_star\_001 database includes more details on the specific user, including the insititution and the role of the user.\\
To ensure the integrity of the user request for authentication the form on login.php includes a random sequence, which is both stored, in the session and the POST submission. 
The comparison of the both results should ensure better protection from XSS-attacks.\\
Data processing happen in 4 steps, which come up sequencially.
\begin{enumerate}
 \item At first the script checks, whether a username exists, which matches the username provided in the form. In case the username can not be found in the database ``auth'', the script
 redirects the user to login.php and creates error message, indicating unknown username. Otherwise the script continues to step 2.
 \item In case, a user has tried, a login with non matching credentials, too many times, the user is redirected to the login.php page and told to wait for some time. This settings 
 should slow down brute force attacks on available accounts.
 \item If the username has been found, the script checks, whether the password, provided by the user, matches the password stored in the ``auth`` database. Therefore the PHP function 
 password\_verify() is used. If the password provided does not match to the hash value, stored in the database, the user is redirected to login.php, receiving an error message about the 
 password. Otherwise the script starts to initiate a session.
 \item In the next step the script starts to create a session for the use of the research database. In order to ensure the security of the session, several steps are taken:
 \begin{itemize}
  \item the IP address of the user is stored as a session variable to prevent session hijacking
  \item the user agent of the user's browser is also stored as a session variable to prevent session hijacking
  \item the user's institution is stored to regulate access to the data stored in the research database, this information is encoded in the group id, which is set as a session
  variable, instead of the group name and the department
  \item the username is stored into the session to allow recognition of the user 
  \item the user-id is stored into the session, because it is the primary key to the users in the different databases
  \item the session-id is stored into the session aswell, to allow the recognition of the session in the further session administration system
 \end{itemize}
  Afterwards, the user is redirected to home.php, which acts as the main page. In order to check on the usage of the website, all successful logins are logged into a separate 
  table in the logging database. To minimize the tracking of single users according to their IP address, the IP address is shortened to three blocks, which still allows sufficient 
  data for the analysis of user interaction with the database.
  \item In case no login information has been provided by the user, the user is redirected to login.php .\\
\end{enumerate}
In case the login failed, the attempt is written into the Login\_Failed table in the logdb database, to track bruteforce attacks on user accounts.\\
The database connections are closed at the end of each script to prevent accumulation of unused database connection by various scripts.

\subsection{check-session.php and check-session\_restricted.php}
The both scripts check-session.php and check-session\_restricted.php act as the connecting scripts between the different pages within the project. The basic intention of the scripts is to check, whether a session for the user exists and whether the user, therefore, is allowed to access pages within the project. Furthermore, the check-session\_restricted.php script checks, whether the logged in user has sufficient 
permissions, to access limited pages. 
